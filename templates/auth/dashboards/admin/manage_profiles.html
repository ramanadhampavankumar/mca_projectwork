{% extends 'base/base_admin.html' %}
{% block title %}Admin{% endblock title %} 

{% block body %}
<main>
    <h1>Manage Profiles</h1>
    <div class="div-sec">
        <!-- Flash message display -->
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <ul class="flash-messages">
                    {% for message in messages %}
                        <li class="flash-message">{{ message }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}

        <!-- Form to add a new user -->
        <form action="{{ url_for('manage_profiles') }}" id="form-sec" method="POST">
            <input type="text" name="userid" class="text-sec" placeholder="ID Number" required pattern="\d+"
                title="ID Number should only contain digits." />
            <input type="text" name="username" class="text-sec" placeholder="Name" required
                title="Please provide a valid name." />
            <input type="text" name="role" class="text-sec" placeholder="Role" required
                title="Please provide a role." />
            <input type="password" name="password" placeholder="Password" required title="Please provide a password." />
            <input type="submit" value="Add User" id="add_btn" />
        </form>
    </div>

    <!-- Message if there are no users -->
    {% if subjects|length < 1 %}
        <h4>No users found. Add a user above.</h4>
    {% else %}
        <!-- Table to show existing users -->
        <div style="overflow-x: auto; max-width: 100%;">
            <table>
                <thead>
                    <tr>
                        <th>ID Number</th>
                        <th>Name</th>
                        <th>Role</th>
                        <th>Password</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for task in subjects %}
                        <tr>
                            <td>{{ task.userid }}</td>
                            <td>{{ task.username }}</td>
                            <td>{{ task.role }}</td>
                            <td>******</td>
                            <td>
                                <!-- Delete button linked to the delete route -->
                                <a href="/delete/{{ task.id }}" class="delete" 
                                    onclick="return confirm('Are you sure you want to delete this user?')">Delete</a>
                                <br />
                                <a href="/admin/update_profiles/{{ task.id }}" class="update">Update</a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}
</main>
{% endblock body %}
